<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sentinel-AI — LLM-Based Antivirus Simulator</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/pyodide.js"></script>
<style>
:root{--bg:#050e20;--panel:#0b1b2a;--accent:#00c6ff;--good:#00d38a;--danger:#ff6b6b;--muted:#aabdd6;}
body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:#e6f2ff}
header{display:flex;justify-content:space-between;align-items:center;padding:16px 22px;border-bottom:1px solid rgba(255,255,255,0.08);}
.logo{display:flex;align-items:center;gap:10px;font-weight:700}
.logo div{width:38px;height:38px;background:linear-gradient(135deg,#003b53,#00c6ff);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;color:white}
.status{font-size:13px;color:var(--muted)}
.progress{width:120px;height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;display:inline-block;margin-left:6px;vertical-align:middle}
.progress div{height:6px;width:0;background:var(--accent);transition:width .3s}
.layout{display:grid;grid-template-columns:360px 1fr;gap:14px;padding:14px}
.panel{background:var(--panel);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.4)}
button{background:var(--accent);border:none;color:#011;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer;margin-right:8px}
button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--muted)}
#logs{height:160px;overflow:auto;background:#081425;padding:8px;border-radius:8px;font-family:monospace;font-size:13px}
#reason{background:#081425;padding:8px;border-radius:8px;font-size:13px;min-height:100px}
canvas{width:100%;height:200px;border-radius:8px;background:#060f20}
.small{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<header>
 <div class="logo"><div>AV</div><span>Sentinel-AI Simulator</span></div>
 <div class="status">Status: <span id="statustxt">Initializing…</span>
   <span class="progress"><div id="progressbar"></div></span>
 </div>
</header>

<div class="layout">
  <div class="panel">
    <h3>Controls</h3>
    <label>Behavior count: <b id="countlbl">100</b></label>
    <input id="count" type="range" min="50" max="300" value="100" step="25"/><br>
    <label>Malicious ratio: <b id="ratlbl">0.4</b></label>
    <input id="ratio" type="range" min="0" max="1" value="0.4" step="0.05"/><br><br>
    <button id="simulate">Run Simulation</button>
    <button id="reset" class="secondary">Reset</button>
    <p class="small">This demo synthetically generates benign &amp; malicious behaviors, feeds them to a simulated “LLM engine,”
    and visualizes detection accuracy, live events, and reasoning output — all in your browser.</p>
  </div>

  <div style="display:flex;flex-direction:column;gap:12px">
    <div class="panel">
      <h3>Live Activity Feed</h3>
      <canvas id="gauge"></canvas>
      <div id="logs"></div>
    </div>

    <div class="panel" id="results" style="display:none">
      <h3>Detection Metrics</h3>
      <div id="plots"></div>
      <h4>Model Reasoning</h4>
      <div id="reason"></div>
    </div>
  </div>
</div>

<footer style="padding:12px 20px" class="small">
All data are synthetic. Educational simulation of an LLM-driven antivirus. No real malware involved.
</footer>

<script type="module">
const stat=document.getElementById("statustxt"),bar=document.getElementById("progressbar");
function setStatus(t,p=0,c="#00c6ff"){stat.textContent=t;bar.style.width=p+"%";bar.style.background=c;}

let pyodide=null;
async function initPyodide(){
  try{
    setStatus("Downloading Pyodide…",20);
    pyodide=await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.24.1/"});
    setStatus("Loading numpy…",60);
    await pyodide.loadPackage(["numpy"]);
    setStatus("Compiling engine…",80);
    await pyodide.runPythonAsync(pythonCore);
    setStatus("Ready ✅",100,"#00d38a");
  }catch(e){console.error(e);setStatus("Error",100,"#ff6b6b");}
}
initPyodide();

const pythonCore=`
import numpy as np, json, random
BEHAVIORS={
 "benign":["opened file","read config","sent ping","displayed GUI","checked update","accessed cache"],
 "ransomware":["encrypted file","deleted backup","renamed extension","dropped note"],
 "keylogger":["hooked keyboard","logged keystroke","opened hidden socket"],
 "miner":["high cpu","connected mining pool","downloaded payload"]
}
def gen_dataset(n=100,mal_ratio=0.4):
 data=[]
 for _ in range(n):
  if random.random()<mal_ratio:
   typ=random.choice(["ransomware","keylogger","miner"])
   acts=random.sample(BEHAVIORS[typ],k=min(3,len(BEHAVIORS[typ])))
   label="malicious"
  else:
   acts=random.sample(BEHAVIORS["benign"],k=min(3,len(BEHAVIORS["benign"])))
   label="benign"
  data.append({"actions":acts,"label":label})
 return data

def llm_detect(event):
 text=" ".join(event["actions"]).lower()
 score=0
 if any(k in text for k in ["encrypt","backup","extension"]): score+=0.6
 if any(k in text for k in ["keyboard","keystroke"]): score+=0.5
 if "cpu" in text or "pool" in text: score+=0.4
 if "ping" in text or "cache" in text: score-=0.3
 return max(0,min(1,0.5+score))
def simulate(n=100,mal_ratio=0.4):
 data=gen_dataset(n,mal_ratio)
 preds=[]
 for ev in data:
  sc=llm_detect(ev)
  pred="malicious" if sc>0.6 else "benign"
  preds.append({"actions":ev["actions"],"label":ev["label"],"pred":pred,"score":sc})
 acc=sum(1 for p in preds if p["label"]==p["pred"])/len(preds)
 tp=sum(1 for p in preds if p["label"]=="malicious" and p["pred"]=="malicious")
 fp=sum(1 for p in preds if p["label"]=="benign" and p["pred"]=="malicious")
 fn=sum(1 for p in preds if p["label"]=="malicious" and p["pred"]=="benign")
 precision=tp/(tp+fp+1e-9); recall=tp/(tp+fn+1e-9)
 reasoning=f"LLM detected patterns associated with encryption and keylogging; precision={precision:.2f}, recall={recall:.2f}."
 return json.dumps({"preds":preds,"acc":acc,"precision":precision,"recall":recall,"reason":reasoning})
`;

const gauge=document.getElementById("gauge"),gctx=gauge.getContext("2d");
function drawGauge(v){
  const w=gauge.width=400,h=gauge.height=200;gctx.clearRect(0,0,w,h);
  gctx.lineWidth=20;gctx.beginPath();gctx.strokeStyle="#082440";
  gctx.arc(w/2,h*0.9,80,Math.PI,0,false);gctx.stroke();
  const angle=Math.PI+v*Math.PI;
  gctx.beginPath();gctx.strokeStyle=v>0.6?"#ff6b6b":v>0.3?"#00c6ff":"#00d38a";
  gctx.arc(w/2,h*0.9,80,Math.PI,angle,false);gctx.stroke();
  gctx.fillStyle="#fff";gctx.font="20px sans-serif";
  gctx.fillText((v*100).toFixed(0)+"%",w/2-20,h*0.9+10);
}

async function runSim(){
 if(!pyodide){alert("Python not ready");return;}
 const n=parseInt(document.getElementById("count").value);
 const r=parseFloat(document.getElementById("ratio").value);
 setStatus("Running simulation…",60,"#ffb86b");
 const pycall=\`simulate(\${n},\${r})\`;
 const res=JSON.parse(await pyodide.runPythonAsync(pycall));
 displayResults(res);
 setStatus("Complete ✅",100,"#00d38a");
}

function displayResults(res){
 document.getElementById("results").style.display="block";
 const logs=document.getElementById("logs");
 logs.innerHTML="";
 let idx=0;
 function step(){
   if(idx>=res.preds.length)return;
   const e=res.preds[idx];
   const color=e.pred=="malicious"?(e.label=="malicious"?"#ff6b6b":"#ffaa00"):"#00d38a";
   logs.innerHTML+=\`<span style="color:\${color}">[\${e.pred.toUpperCase()}]</span> \${e.actions.join(", ")}<br>\`;
   logs.scrollTop=logs.scrollHeight;
   drawGauge(e.score);
   idx++;setTimeout(step,80);
 }
 step();
 const rdiv=document.getElementById("reason");
 rdiv.textContent=res.reason;
 const accTrace={x:["Accuracy","Precision","Recall"],y:[res.acc,res.precision,res.recall],type:"bar",
   marker:{color:["#00d38a","#00c6ff","#ffb86b"]}};
 Plotly.newPlot("plots",[accTrace],{title:"Detection Performance",yaxis:{range:[0,1]}},{responsive:true});
}

document.getElementById("simulate").onclick=runSim;
document.getElementById("reset").onclick=()=>{document.getElementById("logs").innerHTML="";document.getElementById("reason").textContent="";setStatus("Ready ✅",100,"#00d38a");};
document.getElementById("count").oninput=e=>{document.getElementById("countlbl").textContent=e.target.value;}
document.getElementById("ratio").oninput=e=>{document.getElementById("ratlbl").textContent=e.target.value;}
</script>
</body>
</html>
