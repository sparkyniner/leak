<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Browser / Device Info Tester ‚Äî Single File (Consent)</title>
<style>
  :root{--bg:#071226;--panel:#0b2130;--accent:#00c6ff;--muted:#9fb9d1}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#eaf6ff}
  .wrap{max-width:980px;margin:28px auto;padding:20px}
  header{display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:14px}
  .panel{background:var(--panel);padding:14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.6)}
  pre{background:#021425;padding:12px;border-radius:8px;overflow:auto;max-height:520px}
  .controls{display:flex;flex-direction:column;gap:8px}
  input[type="text"]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#eaf6ff}
  button{background:var(--accent);border:0;padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  label{font-size:13px;color:var(--muted)}
  footer{margin-top:14px;color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#002b3a,#00c6ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#001">BI</div>
    <div>
      <h1>Browser & Device Info Tester (Consent-based)</h1>
      <div class="small">Collects browser-exposed signals and shows them locally. Only sends data if user consents.</div>
    </div>
  </header>

  <div class="grid" style="margin-top:18px">
    <div class="panel">
      <h3>Collected Data</h3>
      <pre id="output">Gathering data ‚Äî please wait‚Ä¶</pre>
      <footer class="small">Data shown above is gathered from public browser APIs (client hints, WebGL, screen, battery, etc.). No data leaves your browser until you click <strong>Send to admin</strong> with consent.</footer>
    </div>

    <div class="panel">
      <h3>Admin / Controls</h3>
      <div class="controls">
        <label>Optional: paste your admin endpoint (webhook) to POST JSON to (e.g. Vercel function URL)</label>
        <input id="adminUrl" type="text" placeholder="https://project.vercel.app/api/submit" />
        <label><input id="consent" type="checkbox" /> I consent to send my browser/device info to admin</label>

        <div class="row">
          <button id="sendBtn" disabled>Send to admin</button>
          <button class="btn-ghost" id="copyBtn">Copy JSON</button>
        </div>

        <div style="margin-top:6px" class="small">
          <strong>Notes:</strong>
          <ul style="margin:6px 0 0 18px">
            <li>Do not use to collect data from people without consent.</li>
            <li>Vercel logs or any webhook you provide will receive the JSON when sent.</li>
            <li>Server-side storage / logging must be secured (admin only).</li>
          </ul>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.04)" />

        <label class="small">Developer / admin tips</label>
        <div class="small">
          - If you want to log on Vercel, deploy a serverless function at <code>/api/submit</code> that prints request body to console.<br>
          - You can view Vercel function logs in Vercel Dashboard ‚Üí Project ‚Üí Functions ‚Üí Logs.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// --------- helper utilities ----------
function nowISO(){return new Date().toISOString();}
function safe(fn, fallback){ try{ return fn(); } catch(e){ return fallback; } }

// --------- feature collectors ----------
async function getClientHints(){
  if (!('userAgentData' in navigator)) return null;
  try{
    // request common high-entropy values; this may prompt the UA client hint mechanism
    const hints = await navigator.userAgentData.getHighEntropyValues([
      "architecture","model","platform","platformVersion","uaFullVersion"
    ]);
    return hints;
  }catch(e){ return null; }
}

async function getWebGLInfo(){
  try{
    const canvas = document.createElement('canvas');
    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if(!gl) return {};
    const dbg = gl.getExtension('WEBGL_debug_renderer_info');
    if(!dbg) return {};
    return {
      renderer: safe(()=>gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL), null),
      vendor: safe(()=>gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL), null)
    };
  } catch(e){ return {}; }
}

function getCanvasFingerprint(){
  try{
    const c = document.createElement('canvas');
    c.width = 280; c.height = 60;
    const ctx = c.getContext('2d');
    ctx.fillStyle = '#f7f7f7'; ctx.fillRect(0,0,280,60);
    ctx.textBaseline = "top"; ctx.font = "16px 'Arial'";
    ctx.fillStyle = '#091023'; ctx.fillText("Fingerprint test ‚Äî ùïãùïñùï§ùï•", 10, 10);
    // draw shapes
    ctx.fillStyle = "#ff6b6b"; ctx.fillRect(190,10,40,40);
    const dataURL = c.toDataURL();
    // hash simple
    let hash = 0;
    for(let i=0;i<dataURL.length;i++){ hash = ((hash<<5)-hash)+dataURL.charCodeAt(i); hash |= 0; }
    return { dataURLPreview: dataURL.slice(0,120), hash: (hash>>>0).toString(16) };
  } catch(e){ return {}; }
}

async function getBatteryInfo(){
  if (!('getBattery' in navigator)) return null;
  try{
    const bat = await navigator.getBattery();
    return { level: bat.level, charging: bat.charging, chargingTime: bat.chargingTime, dischargingTime: bat.dischargingTime };
  } catch(e){ return null; }
}

function testMediaCodecs(){
  try{
    const video = document.createElement('video');
    const types = [
      "video/mp4; codecs='avc1.42E01E'",
      "video/mp4; codecs='hev1'",
      "video/mp4; codecs='vp09.00.10.08'",
      "video/webm; codecs='vp9'",
      "video/mp4; codecs='av01.0.05M.08'"
    ];
    const results = {};
    types.forEach(t => { try { results[t] = !!video.canPlayType(t); } catch(e){ results[t]=false; } });
    return results;
  } catch(e){ return {}; }
}

function getFontsProbe(){
  // gentle fonts probe (non-exhaustive)
  const baseFonts = ["monospace","serif","sans-serif"];
  const testFonts = ["Arial","Roboto","Noto Sans","Pixel","SF Pro Text","Segoe UI Emoji"];
  const probe = {};
  const span = document.createElement('span');
  span.style.fontSize='28px'; span.style.position='absolute'; span.style.left='-9999px'; span.innerText='abcdefghi0123456789';
  document.body.appendChild(span);
  const defaultWidth = {};
  baseFonts.forEach(b => {
    span.style.fontFamily = b; defaultWidth[b] = span.offsetWidth;
  });
  testFonts.forEach(f => {
    let found=false;
    baseFonts.forEach(b => {
      span.style.fontFamily = `'${f}',${b}`;
      if (span.offsetWidth !== defaultWidth[b]) found = true;
    });
    probe[f] = found;
  });
  document.body.removeChild(span);
  return probe;
}

// --------- main collect function ----------
async function collectAll(){
  const clientHints = await getClientHints();
  const webgl = await getWebGLInfo();
  const canvas = getCanvasFingerprint();
  const battery = await getBatteryInfo();
  const codecs = testMediaCodecs();
  const fonts = getFontsProbe();

  const data = {
    collected_at: nowISO(),
    userAgent: navigator.userAgent || null,
    clientHints: clientHints,
    platform: navigator.platform || null,
    languages: navigator.languages || null,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || null,
    screen: {
      width: screen.width, height: screen.height,
      availWidth: screen.availWidth, availHeight: screen.availHeight,
      colorDepth: screen.colorDepth || null,
      devicePixelRatio: window.devicePixelRatio || null
    },
    hardware: {
      deviceMemory: navigator.deviceMemory || null,
      hardwareConcurrency: navigator.hardwareConcurrency || null
    },
    webgl, canvas, battery, codecs, fonts,
    cookiesEnabled: navigator.cookieEnabled || false,
    doNotTrack: navigator.doNotTrack || null,
    referrer: document.referrer || null
  };
  return data;
}

// --------- UI wiring ----------
const out = document.getElementById('output');
const sendBtn = document.getElementById('sendBtn');
const copyBtn = document.getElementById('copyBtn');
const consentBox = document.getElementById('consent');
const adminInput = document.getElementById('adminUrl');

let lastData = null;

consentBox.addEventListener('change', ()=>{
  sendBtn.disabled = !consentBox.checked;
});

copyBtn.addEventListener('click', ()=>{
  if (!lastData) return alert('No data yet');
  const s = JSON.stringify(lastData, null, 2);
  navigator.clipboard ? navigator.clipboard.writeText(s).then(()=>alert('Copied JSON to clipboard')) : (prompt('Copy JSON', s));
});

sendBtn.addEventListener('click', async ()=>{
  if (!lastData) return alert('No data to send');
  if (!consentBox.checked) return alert('Consent required');
  const adminUrl = adminInput.value.trim();
  if (!adminUrl) return alert('Please paste your admin endpoint URL (e.g. https://<project>.vercel.app/api/submit)');
  try{
    const resp = await fetch(adminUrl, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(lastData) });
    if (resp.ok) {
      alert('Sent successfully to admin endpoint (server logs will show it).');
    } else {
      alert('Failed to send: ' + resp.status + ' ' + resp.statusText);
    }
  } catch(e){
    alert('Send error: ' + e.message);
  }
});

// run on load
(async ()=>{
  out.textContent = 'Gathering data ‚Äî please wait...';
  lastData = await collectAll();
  out.textContent = JSON.stringify(lastData, null, 2);
})();
</script>
</body>
</html>
